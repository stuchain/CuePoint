# Implementation Step 9.1: Visual Consistency

## Implementation Overview
**What We're Building**: A comprehensive visual consistency system that establishes a unified design language across all UI components in CuePoint. This system provides centralized theme tokens (colors, spacing, typography, radii), defines consistent interaction states for all controls, ensures consistent sizing and styling, and creates a cohesive visual experience that makes the application feel professional, polished, and intentionally designed rather than a collection of disparate components. The visual consistency system serves as the foundation for all UI development, ensuring that every new component automatically inherits the design language and that the application maintains visual coherence as it evolves.

## Implementation Tasks

### Task 9.1.1: Define Theme Token Architecture

**What to Build**
- Centralized theme token system
- Token categorization and organization
- Token naming conventions
- Token value definitions
- Platform-specific token overrides
- Token validation and documentation
- Theme token API and access patterns

**Implementation Details**

**9.1.1.1 Color Token System**
- **Purpose**: Define a comprehensive color palette that provides semantic meaning, ensures accessibility, and maintains visual consistency across all UI components.
- **Rationale**: 
  - Centralized color definitions prevent color inconsistencies
  - Semantic color names (primary, error, success) make code more maintainable
  - Color tokens enable easy theme switching and dark mode support
  - Consistent colors build brand recognition and professional appearance
  - Accessibility compliance requires controlled color choices
- **Implementation Location**: `SRC/cuepoint/ui/widgets/theme_tokens.py` (new file)
- **Color Token Categories**:
  - **Base Colors**: Background, surface, border colors that form the foundation
  - **Semantic Colors**: Primary, secondary, accent colors for actions and emphasis
  - **Status Colors**: Success, warning, error, info colors for feedback
  - **Text Colors**: Primary text, secondary text, disabled text for readability
  - **Interactive Colors**: Hover, pressed, focused states for interactive elements
- **Color Token Structure**:
  ```python
  from dataclasses import dataclass
  from typing import Dict
  
  @dataclass
  class ColorTokens:
      """Centralized color token definitions."""
      
      # Base colors
      background: str          # Main window background
      surface: str             # Panel, card, group box background
      border: str              # Border color for inputs, panels
      border_subtle: str       # Subtle borders (dividers, separators)
      
      # Semantic colors
      primary: str             # Primary action color (buttons, links)
      primary_hover: str       # Primary hover state
      primary_pressed: str     # Primary pressed state
      secondary: str           # Secondary actions
      accent: str              # Accent color for highlights
      
      # Status colors
      success: str             # Success feedback
      warning: str             # Warning feedback
      error: str               # Error feedback
      info: str                # Informational feedback
      
      # Text colors
      text_primary: str        # Primary text (high contrast)
      text_secondary: str      # Secondary text (medium contrast)
      text_disabled: str       # Disabled text (low contrast, still readable)
      text_inverse: str        # Text on colored backgrounds
      
      # Interactive states
      hover_overlay: str       # Hover overlay (rgba)
      pressed_overlay: str     # Pressed overlay (rgba)
      focus_ring: str          # Focus indicator color
      selection: str           # Selection background
      
      # Platform-specific overrides
      @classmethod
      def for_platform(cls, platform: str) -> 'ColorTokens':
          """Get color tokens for specific platform."""
          if platform == "darwin":  # macOS
              return cls(
                  background="#1e1e1e",
                  surface="#2d2d2d",
                  border="#3d3d3d",
                  border_subtle="#2d2d2d",
                  primary="#007AFF",      # macOS blue
                  primary_hover="#0056b3",
                  primary_pressed="#004085",
                  secondary="#5856D6",    # macOS purple
                  accent="#30D158",         # macOS green
                  success="#4CAF50",
                  warning="#FF9800",
                  error="#F44336",
                  info="#2196F3",
                  text_primary="#ffffff",
                  text_secondary="#8e8e93",  # macOS secondary text
                  text_disabled="#5a5a5a",    # Still readable
                  text_inverse="#ffffff",
                  hover_overlay="rgba(255, 255, 255, 0.08)",
                  pressed_overlay="rgba(255, 255, 255, 0.12)",
                  focus_ring="#007AFF",
                  selection="rgba(0, 122, 255, 0.35)",
              )
          else:  # Windows/Linux
              return cls(
                  background="#1e1e1e",
                  surface="#252526",
                  border="#3c3c3c",
                  border_subtle="#2d2d2d",
                  primary="#0078d4",      # Windows blue
                  primary_hover="#106ebe",
                  primary_pressed="#005a9e",
                  secondary="#6b69d6",
                  accent="#4CAF50",
                  success="#4CAF50",
                  warning="#FF9800",
                  error="#F44336",
                  info="#2196F3",
                  text_primary="#ffffff",
                  text_secondary="#888888",
                  text_disabled="#666666",    # Still readable
                  text_inverse="#ffffff",
                  hover_overlay="rgba(255, 255, 255, 0.08)",
                  pressed_overlay="rgba(255, 255, 255, 0.12)",
                  focus_ring="#0078d4",
                  selection="rgba(0, 120, 212, 0.35)",
              )
  ```
- **Color Accessibility Requirements**:
  - **Contrast Ratios**: All text colors must meet WCAG AA standards (4.5:1 for normal text, 3:1 for large text)
  - **Disabled State**: Disabled text must still be readable (minimum 3:1 contrast)
  - **Focus Indicators**: Focus rings must have sufficient contrast (3:1 minimum)
  - **Status Colors**: Status colors must be distinguishable and accessible
  - **Validation**: Automated contrast checking for all color combinations
- **Color Usage Guidelines**:
  - **Primary Color**: Use for primary actions (Start button, Export button)
  - **Secondary Color**: Use for secondary actions (Cancel, Back)
  - **Accent Color**: Use sparingly for highlights and emphasis
  - **Status Colors**: Use consistently for success/error/warning/info feedback
  - **Text Colors**: Use text_primary for main content, text_secondary for labels and hints
  - **Background Colors**: Use background for main window, surface for panels
- **Benefits**:
  - Single source of truth for all colors
  - Easy theme switching and customization
  - Consistent visual appearance
  - Accessibility compliance built-in
  - Maintainable and scalable

**9.1.1.2 Spacing Token System**
- **Purpose**: Define a consistent spacing scale that creates visual rhythm, improves readability, and ensures consistent layout spacing across all UI components.
- **Rationale**:
  - Consistent spacing creates visual harmony
  - Spacing scale prevents arbitrary spacing values
  - Predictable spacing improves layout consistency
  - Spacing tokens make responsive design easier
  - Consistent spacing improves visual hierarchy
- **Implementation Location**: `SRC/cuepoint/ui/widgets/theme_tokens.py` (extend existing)
- **Spacing Token Scale**: Use a 4px base unit for consistent spacing
  ```python
  @dataclass
  class SpacingTokens:
      """Centralized spacing token definitions."""
      
      # Base spacing scale (4px increments)
      xs: int = 4      # Extra small spacing (tight grouping)
      sm: int = 6     # Small spacing (related elements)
      md: int = 8     # Medium spacing (standard spacing)
      lg: int = 12    # Large spacing (section separation)
      xl: int = 16    # Extra large spacing (major sections)
      xxl: int = 24   # Extra extra large (page-level separation)
      
      # Component-specific spacing
      button_padding_x: int = 16    # Horizontal button padding
      button_padding_y: int = 8     # Vertical button padding
      input_padding_x: int = 6      # Horizontal input padding
      input_padding_y: int = 4      # Vertical input padding
      group_margin_top: int = 12    # Top margin for group boxes
      group_padding: int = 6         # Internal group box padding
      
      # Layout spacing
      window_margin: int = 8        # Window edge margin
      section_spacing: int = 16     # Spacing between major sections
      control_spacing: int = 8      # Spacing between form controls
      label_spacing: int = 6        # Spacing between label and control
      
      # Platform-specific overrides
      @classmethod
      def for_platform(cls, platform: str) -> 'SpacingTokens':
          """Get spacing tokens for specific platform."""
          if platform == "darwin":  # macOS
              return cls(
                  xs=4, sm=6, md=6, lg=10, xl=14, xxl=20,
                  button_padding_x=14,
                  button_padding_y=5,
                  input_padding_x=6,
                  input_padding_y=4,
                  group_margin_top=10,
                  group_padding=6,
                  window_margin=6,
                  section_spacing=14,
                  control_spacing=6,
                  label_spacing=6,
              )
          else:  # Windows/Linux
              return cls(
                  xs=4, sm=6, md=8, lg=12, xl=16, xxl=24,
                  button_padding_x=16,
                  button_padding_y=8,
                  input_padding_x=6,
                  input_padding_y=4,
                  group_margin_top=12,
                  group_padding=8,
                  window_margin=8,
                  section_spacing=16,
                  control_spacing=8,
                  label_spacing=6,
              )
  ```
- **Spacing Usage Guidelines**:
  - **xs (4px)**: Tight grouping within components (icon + text, checkbox + label)
  - **sm (6px)**: Related elements (form fields in same group, buttons in toolbar)
  - **md (8px)**: Standard spacing (between form groups, list items)
  - **lg (12px)**: Section separation (between major UI sections)
  - **xl (16px)**: Major sections (between tabs, between main content areas)
  - **xxl (24px)**: Page-level separation (between completely different views)
- **Spacing Consistency Rules**:
  - Always use spacing tokens, never arbitrary values
  - Maintain consistent spacing within component types
  - Use larger spacing for visual separation
  - Use smaller spacing for related elements
  - Respect platform-specific spacing preferences
- **Benefits**:
  - Consistent visual rhythm
  - Predictable layouts
  - Easy to maintain and update
  - Platform-appropriate spacing
  - Improved visual hierarchy

**9.1.1.3 Typography Token System**
- **Purpose**: Define a consistent typography scale that ensures readable, hierarchical text presentation across all UI components.
- **Rationale**:
  - Consistent typography improves readability
  - Typography scale creates visual hierarchy
  - Consistent font sizes improve professional appearance
  - Typography tokens enable easy theme customization
  - Platform-specific typography respects OS conventions
- **Implementation Location**: `SRC/cuepoint/ui/widgets/theme_tokens.py` (extend existing)
- **Typography Token Structure**:
  ```python
  @dataclass
  class TypographyTokens:
      """Centralized typography token definitions."""
      
      # Font families
      font_family: str = "system"  # Use system font stack
      font_family_mono: str = "monospace"  # Monospace for code/data
      
      # Font sizes (in pixels)
      font_size_xs: int = 10    # Extra small (tooltips, captions)
      font_size_sm: int = 11   # Small (secondary text, labels)
      font_size_base: int = 12  # Base (body text, default)
      font_size_md: int = 13   # Medium (emphasis, headings)
      font_size_lg: int = 14   # Large (section headings)
      font_size_xl: int = 16   # Extra large (page titles)
      font_size_xxl: int = 18  # Extra extra large (major headings)
      
      # Font weights
      font_weight_normal: int = 400
      font_weight_medium: int = 500
      font_weight_semibold: int = 600
      font_weight_bold: int = 700
      
      # Line heights
      line_height_tight: float = 1.2   # Tight (headings)
      line_height_normal: float = 1.5  # Normal (body text)
      line_height_relaxed: float = 1.8 # Relaxed (long form text)
      
      # Letter spacing
      letter_spacing_tight: float = -0.01
      letter_spacing_normal: float = 0.0
      letter_spacing_wide: float = 0.05
      
      # Platform-specific overrides
      @classmethod
      def for_platform(cls, platform: str) -> 'TypographyTokens':
          """Get typography tokens for specific platform."""
          if platform == "darwin":  # macOS
              return cls(
                  font_family="-apple-system, BlinkMacSystemFont, 'SF Pro Text', sans-serif",
                  font_family_mono="'SF Mono', Monaco, 'Cascadia Code', monospace",
                  font_size_xs=10,
                  font_size_sm=11,
                  font_size_base=12,
                  font_size_md=13,
                  font_size_lg=14,
                  font_size_xl=16,
                  font_size_xxl=18,
                  font_weight_normal=400,
                  font_weight_medium=500,
                  font_weight_semibold=600,
                  font_weight_bold=700,
                  line_height_tight=1.2,
                  line_height_normal=1.5,
                  line_height_relaxed=1.8,
              )
          else:  # Windows/Linux
              return cls(
                  font_family="'Segoe UI', system-ui, -apple-system, sans-serif",
                  font_family_mono="'Cascadia Code', 'Consolas', monospace",
                  font_size_xs=10,
                  font_size_sm=11,
                  font_size_base=12,
                  font_size_md=13,
                  font_size_lg=14,
                  font_size_xl=16,
                  font_size_xxl=18,
                  font_weight_normal=400,
                  font_weight_medium=500,
                  font_weight_semibold=600,
                  font_weight_bold=700,
                  line_height_tight=1.2,
                  line_height_normal=1.5,
                  line_height_relaxed=1.8,
              )
  ```
- **Typography Usage Guidelines**:
  - **Body Text**: Use font_size_base (12-13px) for main content
  - **Labels**: Use font_size_sm (11px) for form labels and secondary text
  - **Headings**: Use font_size_lg (14px) or font_size_xl (16px) for section headings
  - **Captions**: Use font_size_xs (10px) for tooltips, captions, fine print
  - **Emphasis**: Use font_weight_semibold or font_weight_bold for emphasis
  - **Monospace**: Use font_family_mono for code, file paths, technical data
- **Typography Accessibility Requirements**:
  - **Minimum Font Size**: 10px minimum for any user-visible text
  - **Readable Sizes**: Body text should be 12-14px for optimal readability
  - **Line Height**: Minimum 1.4 for body text, 1.2 for headings
  - **Contrast**: All text must meet WCAG contrast requirements
  - **Font Loading**: Use system fonts for performance and familiarity
- **Benefits**:
  - Consistent text appearance
  - Clear visual hierarchy
  - Improved readability
  - Platform-appropriate typography
  - Easy to maintain and update

**9.1.1.4 Border Radius Token System**
- **Purpose**: Define consistent border radius values that create a cohesive, modern appearance while respecting platform conventions.
- **Rationale**:
  - Consistent border radius creates visual harmony
  - Platform-specific radii respect OS design language
  - Consistent radii improve professional appearance
  - Radius tokens prevent arbitrary corner rounding
- **Implementation Location**: `SRC/cuepoint/ui/widgets/theme_tokens.py` (extend existing)
- **Border Radius Token Structure**:
  ```python
  @dataclass
  class RadiusTokens:
      """Centralized border radius token definitions."""
      
      # Base radius values
      radius_none: int = 0      # Sharp corners (tables, dividers)
      radius_sm: int = 4       # Small radius (inputs, small buttons)
      radius_md: int = 6       # Medium radius (buttons, cards)
      radius_lg: int = 8       # Large radius (panels, modals)
      radius_xl: int = 12      # Extra large radius (major containers)
      radius_full: int = 9999   # Fully rounded (pills, badges)
      
      # Component-specific radii
      button_radius: int = 6    # Button border radius
      input_radius: int = 4    # Input field border radius
      card_radius: int = 8      # Card/panel border radius
      badge_radius: int = 12    # Badge border radius
      
      # Platform-specific overrides
      @classmethod
      def for_platform(cls, platform: str) -> 'RadiusTokens':
          """Get radius tokens for specific platform."""
          if platform == "darwin":  # macOS (more rounded)
              return cls(
                  radius_none=0,
                  radius_sm=4,
                  radius_md=6,
                  radius_lg=8,
                  radius_xl=12,
                  radius_full=9999,
                  button_radius=6,
                  input_radius=8,      # macOS inputs more rounded
                  card_radius=8,
                  badge_radius=12,
              )
          else:  # Windows/Linux (sharper corners)
              return cls(
                  radius_none=0,
                  radius_sm=2,
                  radius_md=4,
                  radius_lg=6,
                  radius_xl=8,
                  radius_full=9999,
                  button_radius=4,
                  input_radius=4,
                  card_radius=6,
                  badge_radius=8,
              )
  ```
- **Radius Usage Guidelines**:
  - **Buttons**: Use button_radius (6px macOS, 4px Windows)
  - **Inputs**: Use input_radius (8px macOS, 4px Windows)
  - **Cards/Panels**: Use card_radius (8px macOS, 6px Windows)
  - **Badges**: Use badge_radius (12px macOS, 8px Windows)
  - **Tables**: Use radius_none (sharp corners)
  - **Modals**: Use radius_lg or radius_xl for major containers
- **Benefits**:
  - Consistent corner rounding
  - Platform-appropriate appearance
  - Modern, polished look
  - Easy to maintain

**9.1.1.5 Control Size Token System**
- **Purpose**: Define consistent control sizes (heights, widths, minimum sizes) that ensure touch accessibility, visual consistency, and platform-appropriate sizing.
- **Rationale**:
  - Consistent control sizes improve usability
  - Minimum sizes ensure touch accessibility
  - Platform-specific sizes respect OS conventions
  - Consistent sizing creates visual harmony
- **Implementation Location**: `SRC/cuepoint/ui/widgets/theme_tokens.py` (extend existing)
- **Control Size Token Structure**:
  ```python
  @dataclass
  class SizeTokens:
      """Centralized size token definitions."""
      
      # Control heights
      control_height_xs: int = 20   # Extra small (compact UI)
      control_height_sm: int = 24   # Small (secondary controls)
      control_height_md: int = 28   # Medium (standard controls)
      control_height_lg: int = 32   # Large (primary controls)
      control_height_xl: int = 40   # Extra large (prominent actions)
      
      # Component-specific heights
      button_height: int = 28       # Standard button height
      input_height: int = 26       # Input field height
      table_row_height: int = 32    # Table row height
      toolbar_height: int = 40      # Toolbar height
      
      # Minimum touch targets (accessibility)
      min_touch_target: int = 28    # Minimum touch target (iOS/Android guidelines)
      min_click_target: int = 24   # Minimum click target (desktop)
      
      # Icon sizes
      icon_size_xs: int = 12        # Extra small icons
      icon_size_sm: int = 16        # Small icons
      icon_size_md: int = 20        # Medium icons
      icon_size_lg: int = 24        # Large icons
      icon_size_xl: int = 32        # Extra large icons
      
      # Platform-specific overrides
      @classmethod
      def for_platform(cls, platform: str) -> 'SizeTokens':
          """Get size tokens for specific platform."""
          if platform == "darwin":  # macOS
              return cls(
                  control_height_xs=20,
                  control_height_sm=22,
                  control_height_md=26,
                  control_height_lg=28,
                  control_height_xl=32,
                  button_height=28,
                  input_height=26,
                  table_row_height=32,
                  toolbar_height=40,
                  min_touch_target=28,  # macOS HIG recommends 28px
                  min_click_target=24,
                  icon_size_xs=12,
                  icon_size_sm=16,
                  icon_size_md=20,
                  icon_size_lg=24,
                  icon_size_xl=32,
              )
          else:  # Windows/Linux
              return cls(
                  control_height_xs=20,
                  control_height_sm=24,
                  control_height_md=28,
                  control_height_lg=32,
                  control_height_xl=40,
                  button_height=32,
                  input_height=30,
                  table_row_height=32,
                  toolbar_height=44,
                  min_touch_target=28,
                  min_click_target=24,
                  icon_size_xs=12,
                  icon_size_sm=16,
                  icon_size_md=20,
                  icon_size_lg=24,
                  icon_size_xl=32,
              )
  ```
- **Size Usage Guidelines**:
  - **Primary Buttons**: Use button_height (28px macOS, 32px Windows)
  - **Input Fields**: Use input_height (26px macOS, 30px Windows)
  - **Table Rows**: Use table_row_height (32px for comfortable reading)
  - **Touch Targets**: Ensure minimum min_touch_target (28px) for all interactive elements
  - **Icons**: Use icon_size_md (20px) for standard icons, icon_size_lg (24px) for prominent icons
- **Accessibility Requirements**:
  - **Minimum Touch Target**: 28px minimum for all interactive elements (WCAG 2.5.5)
  - **Click Target**: 24px minimum for mouse-based interactions
  - **Visual Target**: Visual target should match or exceed touch target
  - **Spacing**: Adequate spacing between touch targets (8px minimum)
- **Benefits**:
  - Consistent control sizing
  - Touch accessibility compliance
  - Platform-appropriate sizing
  - Improved usability
  - Visual consistency

### Task 9.1.2: Implement Theme Token Access System

**What to Build**
- Theme token access API
- Token resolution and caching
- Platform detection and token selection
- Token validation and error handling
- Token documentation and tooling

**Implementation Details**

**9.1.2.1 Theme Manager Implementation**
- **Purpose**: Create a centralized theme manager that provides easy access to all theme tokens, handles platform detection, and manages theme state.
- **Rationale**:
  - Single access point for all theme tokens
  - Consistent token resolution across application
  - Platform detection handled automatically
  - Easy to extend for future themes (dark mode, custom themes)
  - Performance optimization through caching
- **Implementation Location**: `SRC/cuepoint/ui/widgets/theme.py` (new file)
- **Theme Manager Structure**:
  ```python
  import sys
  from typing import Optional
  from cuepoint.ui.widgets.theme_tokens import (
      ColorTokens, SpacingTokens, TypographyTokens, 
      RadiusTokens, SizeTokens
  )
  
  class ThemeManager:
      """Centralized theme management system."""
      
      _instance: Optional['ThemeManager'] = None
      _colors: Optional[ColorTokens] = None
      _spacing: Optional[SpacingTokens] = None
      _typography: Optional[TypographyTokens] = None
      _radius: Optional[RadiusTokens] = None
      _size: Optional[SizeTokens] = None
      
      def __new__(cls):
          """Singleton pattern."""
          if cls._instance is None:
              cls._instance = super().__new__(cls)
              cls._instance._initialize()
          return cls._instance
      
      def _initialize(self):
          """Initialize theme tokens for current platform."""
          platform = sys.platform
          self._colors = ColorTokens.for_platform(platform)
          self._spacing = SpacingTokens.for_platform(platform)
          self._typography = TypographyTokens.for_platform(platform)
          self._radius = RadiusTokens.for_platform(platform)
          self._size = SizeTokens.for_platform(platform)
      
      @property
      def colors(self) -> ColorTokens:
          """Get color tokens."""
          if self._colors is None:
              self._initialize()
          return self._colors
      
      @property
      def spacing(self) -> SpacingTokens:
          """Get spacing tokens."""
          if self._spacing is None:
              self._initialize()
          return self._spacing
      
      @property
      def typography(self) -> TypographyTokens:
          """Get typography tokens."""
          if self._typography is None:
              self._initialize()
          return self._typography
      
      @property
      def radius(self) -> RadiusTokens:
          """Get radius tokens."""
          if self._radius is None:
              self._initialize()
          return self._radius
      
      @property
      def size(self) -> SizeTokens:
          """Get size tokens."""
          if self._size is None:
              self._initialize()
          return self._size
      
      def get_platform(self) -> str:
          """Get current platform identifier."""
          return sys.platform
      
      def reload(self):
          """Reload theme tokens (useful for theme switching)."""
          self._initialize()
  
  # Global theme manager instance
  def get_theme() -> ThemeManager:
      """Get the global theme manager instance."""
      return ThemeManager()
  ```
- **Usage Pattern**:
  ```python
  from cuepoint.ui.widgets.theme import get_theme
  
  theme = get_theme()
  
  # Access tokens
  primary_color = theme.colors.primary
  button_height = theme.size.button_height
  spacing_md = theme.spacing.md
  font_size = theme.typography.font_size_base
  button_radius = theme.radius.button_radius
  ```
- **Benefits**:
  - Single access point for all tokens
  - Automatic platform detection
  - Easy to extend
  - Performance optimized
  - Type-safe access

**9.1.2.2 Stylesheet Generation from Tokens**
- **Purpose**: Generate Qt stylesheets from theme tokens, ensuring consistency and making it easy to update styles across the application.
- **Rationale**:
  - Stylesheets generated from tokens ensure consistency
  - Single source of truth for styling
  - Easy to update styles globally
  - Reduces hardcoded style values
- **Implementation Location**: `SRC/cuepoint/ui/widgets/styles.py` (enhance existing)
- **Stylesheet Generation**:
  ```python
  from cuepoint.ui.widgets.theme import get_theme
  
  def generate_stylesheet() -> str:
      """Generate complete stylesheet from theme tokens."""
      theme = get_theme()
      colors = theme.colors
      spacing = theme.spacing
      typography = theme.typography
      radius = theme.radius
      size = theme.size
      
      return f"""
          /* Base application styling */
          QMainWindow, QWidget {{
              background-color: {colors.background};
              color: {colors.text_primary};
              font-family: {typography.font_family};
              font-size: {typography.font_size_base}px;
          }}
          
          /* Buttons */
          QPushButton {{
              background-color: {colors.primary};
              color: {colors.text_inverse};
              border: none;
              border-radius: {radius.button_radius}px;
              padding: {spacing.button_padding_y}px {spacing.button_padding_x}px;
              min-height: {size.button_height}px;
              font-weight: {typography.font_weight_medium};
          }}
          
          QPushButton:hover {{
              background-color: {colors.primary_hover};
          }}
          
          QPushButton:pressed {{
              background-color: {colors.primary_pressed};
          }}
          
          QPushButton:disabled {{
              background-color: {colors.border};
              color: {colors.text_disabled};
          }}
          
          /* Inputs */
          QLineEdit, QTextEdit, QPlainTextEdit {{
              background-color: {colors.surface};
              color: {colors.text_primary};
              border: 1px solid {colors.border};
              border-radius: {radius.input_radius}px;
              padding: {spacing.input_padding_y}px {spacing.input_padding_x}px;
              min-height: {size.input_height}px;
          }}
          
          QLineEdit:focus, QTextEdit:focus {{
              border-color: {colors.focus_ring};
          }}
          
          /* Group boxes */
          QGroupBox {{
              border: 1px solid {colors.border};
              border-radius: {radius.card_radius}px;
              margin-top: {spacing.group_margin_top}px;
              padding-top: {spacing.group_padding}px;
          }}
          
          /* Tables */
          QTableView {{
              background-color: {colors.surface};
              alternate-background-color: {colors.hover_overlay};
              selection-background-color: {colors.selection};
          }}
          
          /* Scrollbars */
          QScrollBar:vertical {{
              background-color: {colors.background};
              width: 12px;
          }}
          
          QScrollBar::handle:vertical {{
              background-color: {colors.border};
              border-radius: {radius.radius_md}px;
          }}
          
          QScrollBar::handle:vertical:hover {{
              background-color: {colors.text_secondary};
          }}
      """
  ```
- **Benefits**:
  - Stylesheets generated from tokens
  - Consistent styling across application
  - Easy to update globally
  - Single source of truth

### Task 9.1.3: Define Interaction States

**What to Build**
- Comprehensive interaction state definitions
- State styling and visual feedback
- State transition specifications
- Accessibility requirements for states
- State testing procedures

**Implementation Details**

**9.1.3.1 Button Interaction States**
- **Purpose**: Define all interaction states for buttons (default, hover, pressed, focused, disabled) with clear visual feedback and accessibility compliance.
- **Rationale**:
  - Clear state feedback improves usability
  - Consistent states create professional appearance
  - Accessible states ensure keyboard navigation works
  - State definitions prevent inconsistent implementations
- **State Definitions**:
  - **Default State**: Normal button appearance, ready for interaction
    - Background: `colors.primary`
    - Text: `colors.text_inverse`
    - Border: None
    - Cursor: Pointer
  - **Hover State**: Mouse over button (desktop only)
    - Background: `colors.primary_hover`
    - Text: `colors.text_inverse`
    - Border: None
    - Cursor: Pointer
    - Transition: Smooth color transition (150ms)
  - **Pressed State**: Button being clicked/pressed
    - Background: `colors.primary_pressed`
    - Text: `colors.text_inverse`
    - Border: None
    - Visual feedback: Slight scale down (0.98) or darker color
    - Transition: Immediate
  - **Focused State**: Keyboard focus (tab navigation)
    - Background: `colors.primary`
    - Text: `colors.text_inverse`
    - Border: 2px solid `colors.focus_ring`
    - Outline: Visible focus ring (3px offset)
    - Accessibility: Must be clearly visible (3:1 contrast minimum)
  - **Disabled State**: Button not available
    - Background: `colors.border`
    - Text: `colors.text_disabled`
    - Border: None
    - Cursor: Not-allowed
    - Opacity: 0.6 (optional, if text contrast is sufficient)
- **Implementation**:
  ```python
  # In stylesheet generation
  QPushButton {{
      background-color: {colors.primary};
      color: {colors.text_inverse};
      border: none;
      border-radius: {radius.button_radius}px;
      min-height: {size.button_height}px;
  }}
  
  QPushButton:hover {{
      background-color: {colors.primary_hover};
  }}
  
  QPushButton:pressed {{
      background-color: {colors.primary_pressed};
  }}
  
  QPushButton:focus {{
      border: 2px solid {colors.focus_ring};
      outline: 3px solid {colors.focus_ring}40;  /* 40 = 25% opacity */
  }}
  
  QPushButton:disabled {{
      background-color: {colors.border};
      color: {colors.text_disabled};
  }}
  ```
- **Accessibility Requirements**:
  - Focus state must be clearly visible (3:1 contrast minimum)
  - Focus ring must be at least 2px wide
  - Disabled state must still be readable (3:1 contrast minimum)
  - Hover state must not "flash" (smooth transition)
  - All states must be keyboard accessible
- **Testing Requirements**:
  - Test all states visually
  - Test keyboard navigation (Tab, Enter, Space)
  - Test focus visibility
  - Test disabled state readability
  - Test hover transitions

**9.1.3.2 Input Field Interaction States**
- **Purpose**: Define all interaction states for input fields (default, hover, focused, disabled, error) with clear visual feedback.
- **State Definitions**:
  - **Default State**: Normal input appearance
    - Background: `colors.surface`
    - Text: `colors.text_primary`
    - Border: 1px solid `colors.border`
    - Border radius: `radius.input_radius`
  - **Hover State**: Mouse over input (subtle feedback)
    - Background: `colors.surface`
    - Border: 1px solid `colors.border` (slightly brighter)
    - Cursor: Text
  - **Focused State**: Input has keyboard focus
    - Background: `colors.surface`
    - Border: 2px solid `colors.focus_ring`
    - Outline: Visible focus ring
    - Accessibility: Must be clearly visible
  - **Disabled State**: Input not editable
    - Background: `colors.background`
    - Text: `colors.text_disabled`
    - Border: 1px solid `colors.border`
    - Cursor: Not-allowed
  - **Error State**: Input has validation error
    - Background: `colors.surface`
    - Border: 2px solid `colors.error`
    - Text: `colors.text_primary`
    - Icon: Error icon visible (optional)
- **Implementation**:
  ```python
  QLineEdit, QTextEdit {{
      background-color: {colors.surface};
      color: {colors.text_primary};
      border: 1px solid {colors.border};
      border-radius: {radius.input_radius}px;
      min-height: {size.input_height}px;
  }}
  
  QLineEdit:hover, QTextEdit:hover {{
      border-color: {colors.border_subtle};
  }}
  
  QLineEdit:focus, QTextEdit:focus {{
      border: 2px solid {colors.focus_ring};
      outline: 2px solid {colors.focus_ring}40;
  }}
  
  QLineEdit:disabled, QTextEdit:disabled {{
      background-color: {colors.background};
      color: {colors.text_disabled};
  }}
  
  QLineEdit[error="true"], QTextEdit[error="true"] {{
      border: 2px solid {colors.error};
  }}
  ```
- **Accessibility Requirements**:
  - Focus state must be clearly visible
  - Error state must be clearly indicated
  - Disabled state must still be readable
  - All states must be keyboard accessible

**9.1.3.3 Table Row Interaction States**
- **Purpose**: Define interaction states for table rows (default, hover, selected, focused) with clear visual feedback.
- **State Definitions**:
  - **Default State**: Normal row appearance
    - Background: Transparent or `colors.surface`
    - Text: `colors.text_primary`
  - **Hover State**: Mouse over row
    - Background: `colors.hover_overlay`
    - Text: `colors.text_primary`
  - **Selected State**: Row is selected
    - Background: `colors.selection`
    - Text: `colors.text_primary`
  - **Focused State**: Row has keyboard focus
    - Background: `colors.selection`
    - Border: 2px solid `colors.focus_ring`
    - Text: `colors.text_primary`
- **Implementation**:
  ```python
  QTableView::item {{
      background-color: transparent;
      color: {colors.text_primary};
  }}
  
  QTableView::item:hover {{
      background-color: {colors.hover_overlay};
  }}
  
  QTableView::item:selected {{
      background-color: {colors.selection};
  }}
  
  QTableView::item:focus {{
      border: 2px solid {colors.focus_ring};
  }}
  ```
- **Accessibility Requirements**:
  - Selected state must be clearly visible
  - Focus state must be clearly visible
  - Hover state must be subtle (not distracting)

### Task 9.1.4: Implement Visual Consistency Validation

**What to Build**
- Automated consistency checking
- Token usage validation
- Style compliance checking
- Visual regression testing
- Consistency reporting

**Implementation Details**

**9.1.4.1 Token Usage Validation**
- **Purpose**: Ensure all UI components use theme tokens instead of hardcoded values, preventing inconsistencies and making maintenance easier.
- **Implementation**: Create validation script that scans codebase for hardcoded color/spacing values
- **Validation Rules**:
  - No hardcoded hex colors (except in token definitions)
  - No hardcoded spacing values (except in token definitions)
  - No hardcoded font sizes (except in token definitions)
  - All styles must use theme tokens
- **Benefits**:
  - Prevents inconsistencies
  - Enforces token usage
  - Makes maintenance easier

**9.1.4.2 Visual Consistency Checklist**
- **Purpose**: Manual and automated checklist to ensure visual consistency across all UI components.
- **Checklist Items**:
  - ✅ All buttons use consistent styling
  - ✅ All inputs use consistent styling
  - ✅ All spacing uses tokens
  - ✅ All colors use tokens
  - ✅ All typography uses tokens
  - ✅ All interaction states defined
  - ✅ Focus indicators visible
  - ✅ Disabled states readable
  - ✅ Platform-appropriate styling
  - ✅ Consistent visual hierarchy

## Success Criteria

### Visual Consistency Goals
- ✅ All UI components use theme tokens
- ✅ Consistent spacing and sizing across application
- ✅ All interaction states defined and implemented
- ✅ Platform-appropriate styling applied
- ✅ Visual consistency validated
- ✅ No hardcoded style values
- ✅ Theme system documented
- ✅ Token usage enforced

### Validation Methods
- Automated token usage validation
- Visual consistency review
- Platform-specific testing
- Accessibility testing
- User testing for visual consistency

## Implementation Files

### Core Theme System
1. `SRC/cuepoint/ui/widgets/theme_tokens.py` - Theme token definitions (new)
2. `SRC/cuepoint/ui/widgets/theme.py` - Theme manager (new)
3. `SRC/cuepoint/ui/widgets/styles.py` - Stylesheet generation (enhance existing)

### Validation and Testing
1. `scripts/validate_theme_usage.py` - Token usage validation script (new)
2. `SRC/tests/ui/test_theme_tokens.py` - Theme token tests (new)
3. `SRC/tests/ui/test_visual_consistency.py` - Visual consistency tests (new)

## Dependencies

### Prerequisites
- Step 1: Product Requirements (defines visual design requirements)
- Basic UI components implemented
- Qt/PySide6 styling system

### Enables
- Consistent visual appearance
- Easy theme customization
- Professional polish
- Accessibility compliance
- Maintainable styling system

## References

- Qt Stylesheet Documentation: https://doc.qt.io/qt-6/stylesheet.html
- Material Design: https://material.io/design
- Human Interface Guidelines: https://developer.apple.com/design/human-interface-guidelines/
- Fluent Design: https://www.microsoft.com/design/fluent/
- WCAG Contrast Requirements: https://www.w3.org/WAI/WCAG21/Understanding/contrast-minimum.html
