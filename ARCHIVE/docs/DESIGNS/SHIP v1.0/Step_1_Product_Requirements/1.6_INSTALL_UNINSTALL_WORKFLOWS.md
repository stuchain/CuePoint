# Step 1.6: Install/Uninstall Workflows

## Overview

This document describes the installation and uninstallation workflows for CuePoint on macOS and Windows.

## macOS Installation Workflow

### DMG Installation Process

1. **Download DMG**
   - User downloads `CuePoint-v{VERSION}-macos-universal.dmg` from GitHub Releases
   - DMG is signed and notarized (Step 3)

2. **Mount DMG**
   - User double-clicks DMG file
   - macOS mounts DMG and opens Finder window
   - Window shows:
     - CuePoint.app (left side)
     - Applications folder symlink (right side)
     - README.txt (optional)

3. **Install Application**
   - User drags CuePoint.app to Applications folder
   - App is copied to `/Applications/CuePoint.app`
   - No installer wizard required

4. **First Launch**
   - User opens Applications folder and launches CuePoint
   - macOS Gatekeeper checks signature and notarization
   - If notarized: No warnings, app launches immediately
   - If not notarized: User may see "unidentified developer" warning

5. **Post-Installation**
   - App creates user data directories:
     - `~/Library/Application Support/CuePoint/` (config, data)
     - `~/Library/Caches/CuePoint/` (cache)
     - `~/Library/Logs/CuePoint/` (logs)
   - App initializes default settings
   - First-run onboarding may appear (Step 9.4)

### DMG Contents

- **CuePoint.app**: Application bundle
- **Applications**: Symlink to `/Applications` folder
- **README.txt**: Installation instructions (optional)

### DMG Layout

- **Window Size**: 500x320 pixels
- **Icon Size**: 72x72 pixels
- **App Position**: Left side (120, 205)
- **Applications Position**: Right side (380, 205)
- **Background**: Optional branded background image

## Windows Installation Workflow

### NSIS Installer Process

1. **Download Installer**
   - User downloads `CuePoint-v{VERSION}-windows-x64-setup.exe` from GitHub Releases
   - Installer is signed (Step 4)

2. **Run Installer**
   - User double-clicks installer
   - Windows SmartScreen may show warning (if not widely distributed)
   - User clicks "Run anyway" or "More info" → "Run anyway"

3. **Installer Wizard**
   - **Welcome Page**: Shows application name and version
   - **License Page**: Shows license text, user must accept
   - **Directory Page**: User can choose install location (default: `%LOCALAPPDATA%\CuePoint`)
   - **Installation Page**: Shows progress bar
   - **Finish Page**: 
     - Option to launch CuePoint immediately
     - Option to view README
     - "Close" button

4. **Installation Actions**
   - Files copied to install directory
   - Start Menu shortcuts created:
     - `CuePoint` → Launches app
     - `Uninstall CuePoint` → Runs uninstaller
   - Registry entries created:
     - `HKCU\Software\CuePoint` (app settings)
     - `HKCU\Software\Microsoft\Windows\CurrentVersion\Uninstall\CuePoint` (uninstaller info)
   - Uninstaller created: `{INSTDIR}\uninstall.exe`

5. **First Launch**
   - User can launch from Start Menu or desktop shortcut
   - App creates user data directories:
     - `%APPDATA%\CuePoint\` (config)
     - `%LOCALAPPDATA%\CuePoint\` (data, cache, logs)
   - App initializes default settings
   - First-run onboarding may appear (Step 9.4)

### Installer Features

- **User Installation**: No admin rights required (installs to user directory)
- **Silent Installation**: Supports `/S` flag for silent install
- **Custom Install Location**: User can choose directory
- **Shortcuts**: Start Menu shortcuts created automatically
- **Registry Entries**: Proper Windows integration
- **Uninstaller**: Included in installation

## macOS Uninstallation Workflow

### Manual Uninstallation

1. **Remove Application**
   - User drags `CuePoint.app` from Applications to Trash
   - App bundle is moved to Trash

2. **Empty Trash** (Optional)
   - User empties Trash to permanently delete app
   - App bundle is deleted

3. **User Data Preservation**
   - User data is **preserved** by default:
     - `~/Library/Application Support/CuePoint/` (config, data)
     - `~/Library/Caches/CuePoint/` (cache)
     - `~/Library/Logs/CuePoint/` (logs)
   - User can manually delete these directories if desired

4. **Manual Cleanup** (Optional)
   - User can delete user data directories manually:
     ```bash
     rm -rf ~/Library/Application\ Support/CuePoint
     rm -rf ~/Library/Caches/CuePoint
     rm -rf ~/Library/Logs/CuePoint
     ```

### Uninstallation Characteristics

- **Simple**: Just drag to Trash
- **Data Preserved**: User data not deleted automatically
- **No Uninstaller**: macOS doesn't require uninstaller
- **Manual Cleanup**: User can optionally delete data

## Windows Uninstallation Workflow

### Uninstaller Process

1. **Open Uninstaller**
   - User opens "Add or Remove Programs" (Settings → Apps)
   - Finds "CuePoint" in list
   - Clicks "Uninstall" button

2. **Uninstaller Confirmation**
   - Uninstaller dialog appears
   - Shows confirmation message
   - User clicks "Uninstall" to proceed

3. **Uninstallation Actions**
   - Application files removed from install directory
   - Start Menu shortcuts removed
   - Registry entries removed:
     - `HKCU\Software\CuePoint`
     - `HKCU\Software\Microsoft\Windows\CurrentVersion\Uninstall\CuePoint`

4. **User Data Prompt**
   - Uninstaller asks: "Do you want to delete user data and settings?"
   - Options:
     - **Yes**: Deletes user data directories
     - **No**: Preserves user data (default)
   - User data includes:
     - `%APPDATA%\CuePoint\` (config)
     - `%LOCALAPPDATA%\CuePoint\` (data, cache, logs)

5. **Completion**
   - Uninstaller shows completion message
   - User clicks "OK"
   - Uninstaller closes

### Uninstallation Characteristics

- **Standard Windows Uninstaller**: Integrated with Windows
- **Data Preservation**: User data preserved by default
- **User Choice**: User can choose to delete data
- **Clean Removal**: All app files and registry entries removed

## Installation Validation

### macOS Validation

- [ ] DMG mounts successfully
- [ ] App bundle structure correct
- [ ] App launches from Applications
- [ ] Gatekeeper accepts app (notarized)
- [ ] No Python required
- [ ] User data directories created
- [ ] App runs correctly

### Windows Validation

- [ ] Installer runs successfully
- [ ] App installed to correct location
- [ ] Shortcuts created correctly
- [ ] Registry entries created
- [ ] App launches after installation
- [ ] No Python required
- [ ] User data directories created
- [ ] App runs correctly

## Uninstallation Validation

### macOS Validation

- [ ] App can be dragged to Trash
- [ ] App removed from Applications
- [ ] User data preserved
- [ ] Manual cleanup works (if desired)

### Windows Validation

- [ ] Uninstaller appears in Add/Remove Programs
- [ ] Uninstaller runs successfully
- [ ] App files removed
- [ ] Shortcuts removed
- [ ] Registry entries removed
- [ ] User data preserved (if user chooses)
- [ ] User data deleted (if user chooses)

## Edge Cases

### Installation Edge Cases

1. **App Already Installed**
   - **macOS**: Overwrites existing app (user can choose)
   - **Windows**: Installer detects existing installation, asks to reinstall

2. **Insufficient Disk Space**
   - **macOS**: Copy fails, user sees error
   - **Windows**: Installer checks space, shows error if insufficient

3. **Permission Denied**
   - **macOS**: User may need to enter password for Applications folder
   - **Windows**: User installation doesn't require admin, but may need permissions for some locations

4. **Corrupted Download**
   - **macOS**: DMG won't mount, user should re-download
   - **Windows**: Installer won't run, user should re-download

### Uninstallation Edge Cases

1. **Files Locked**
   - **macOS**: App may be running, user should quit first
   - **Windows**: Uninstaller warns if app is running

2. **Partial Uninstall**
   - **macOS**: User can manually clean up
   - **Windows**: Uninstaller removes what it can, logs issues

3. **User Data Deletion**
   - **macOS**: Manual deletion required
   - **Windows**: User prompted, can choose to preserve or delete

## Success Criteria

### Installation Success

- ✅ Installation success rate > 95%
- ✅ Installation time < 2 minutes
- ✅ No Python required
- ✅ All shortcuts created
- ✅ User data directories created
- ✅ App launches successfully

### Uninstallation Success

- ✅ Uninstallation success rate > 98%
- ✅ Clean removal of app files
- ✅ User data preserved by default
- ✅ User can choose to delete data
- ✅ Uninstaller works correctly

## Testing Requirements

### Manual Testing

- Test on clean macOS 10.15+
- Test on clean macOS 11+
- Test on clean macOS 12+
- Test on clean Windows 10
- Test on clean Windows 11
- Verify no Python required
- Verify all features work after installation

### Automated Testing

- DMG mounting and structure validation
- App bundle structure validation
- Installer silent install
- Uninstaller functionality
- User data preservation

## References

- DMG Creation: `scripts/create_dmg.sh`
- NSIS Installer: `scripts/installer.nsi`
- Installation Tests: `SRC/tests/acceptance/test_installation.py`
- Related: Step 1.4 (Target Outcomes), Step 3 (macOS Packaging), Step 4 (Windows Packaging)
