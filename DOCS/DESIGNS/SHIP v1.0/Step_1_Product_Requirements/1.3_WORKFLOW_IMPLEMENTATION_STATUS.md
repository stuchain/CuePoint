# Step 1.3: Primary Workflows - Implementation Status

## Workflow Overview

This document tracks the implementation status of the five primary user workflows defined in Step 1.3.

## Workflow 1: First Run Workflow

**Definition**: Launch → Onboarding → Select XML → Choose Mode → Choose Playlist → Process → Review → Export

### Implementation Status

| Step | Component | Status | File/Notes |
|------|-----------|--------|------------|
| Launch | Application startup | ✅ Exists | `SRC/gui_app.py` |
| Onboarding | Onboarding dialog | ❌ Needs creation | `SRC/cuepoint/ui/dialogs/onboarding_dialog.py` (Step 9.4) |
| XML Selection | File selector widget | ✅ Exists | `SRC/cuepoint/ui/widgets/file_selector.py` |
| XML Validation | XML parser | ✅ Exists | `SRC/cuepoint/data/rekordbox.py` |
| Mode Selection | Radio buttons | ✅ Exists | `SRC/cuepoint/ui/main_window.py` |
| Playlist Selection | Playlist selector | ✅ Exists | `SRC/cuepoint/ui/widgets/playlist_selector.py` |
| Processing | Processing workflow | ✅ Exists | `SRC/cuepoint/ui/controllers/main_controller.py` |
| Progress Dialog | Progress indication | ⚠️ Needs enhancement | Use `ProgressTracker` from Step 1.1 |
| Results Review | Results view | ✅ Exists | `SRC/cuepoint/ui/widgets/results_view.py` |
| Export | Export dialog | ✅ Exists | `SRC/cuepoint/ui/dialogs/export_dialog.py` (enhanced in Step 1.1) |

### Missing Components
- Onboarding dialog (Step 9.4)
- First-run detection and onboarding trigger
- Enhanced progress dialog using ProgressTracker

### Enhancement Needs
- Integrate ProgressTracker into processing workflow
- Add first-run detection logic
- Enhance error messages for first-time users

## Workflow 2: Repeat Run Workflow

**Definition**: App remembers recent XML + output folder → Choose playlist → Process → Export

### Implementation Status

| Component | Status | File/Notes |
|-----------|--------|------------|
| Recent Files Menu | ✅ Exists | `SRC/cuepoint/ui/main_window.py` (lines 686-1052) |
| Recent Files Storage | ✅ Exists | Uses QSettings |
| State Persistence | ⚠️ Partial | Window geometry not fully implemented |
| Quick Start | ⚠️ Partial | Recent file loading exists, auto-start missing |
| Last Playlist Memory | ❌ Missing | Not currently saved |
| Last Mode Memory | ❌ Missing | Not currently saved |

### Existing Implementation
```python
# Recent files management exists in main_window.py
def save_recent_file(self, file_path: str) -> None:
    """Save file to recent files list"""
    settings = QSettings("CuePoint", "CuePoint")
    recent_files = settings.value("recent_files", [])
    # ... implementation exists
```

### Missing Components
- Window geometry persistence (save/restore)
- Last playlist selection persistence
- Last mode (single/batch) persistence
- Auto-load last XML on startup
- Quick start button/functionality

### Enhancement Needs
- Implement `closeEvent` to save window state
- Implement `restore_state` method
- Save last playlist and mode in QSettings
- Auto-load last XML if it exists

## Workflow 3: Review/Refine Workflow

**Definition**: Use filters to find low-confidence items → Review candidates → Re-export

### Implementation Status

| Component | Status | File/Notes |
|-----------|--------|------------|
| Advanced Filtering | ✅ Exists | `SRC/cuepoint/ui/widgets/results_view.py` |
| Filter UI | ✅ Exists | Search, confidence, year, BPM, key filters |
| Candidate Dialog | ✅ Exists | `SRC/cuepoint/ui/widgets/candidate_dialog.py` |
| Re-export | ✅ Exists | Export dialog supports filtered results |
| Filter Presets | ❌ Missing | Not implemented |
| Clear Filters | ⚠️ Partial | May need enhancement |

### Existing Implementation
- Filtering works with search, confidence, year, BPM, key
- Candidate review dialog exists
- Export supports filtered results

### Enhancement Needs
- Add filter preset save/load
- Add "Clear All Filters" button
- Performance optimization for large result sets
- Filter status indicator (showing X of Y results)

## Workflow 4: Past Searches Workflow

**Definition**: Open Past Searches → Pick prior result → Filter → Export again → Optionally "Re-run Processing"

### Implementation Status

| Component | Status | File/Notes |
|-----------|--------|------------|
| Past Searches Tab | ✅ Exists | `SRC/cuepoint/ui/widgets/history_view.py` |
| CSV Loading | ✅ Exists | `HistoryView.load_csv_file()` |
| CSV Parsing | ✅ Exists | CSV DictReader implementation |
| Filter Application | ✅ Exists | Same filters as results view |
| Export from History | ✅ Exists | Export dialog works with history data |
| Re-run Processing | ⚠️ Partial | Signal exists, needs integration |
| Recent CSV Files | ✅ Exists | Recent files list in history view |

### Existing Implementation
```python
# History view has rerun_requested signal
rerun_requested = Signal(str, str)  # xml_path, playlist_name

# CSV loading works
def load_csv_file(self, file_path: str):
    """Load and display CSV file contents"""
    # Implementation exists
```

### Missing Components
- Re-run processing integration with main window
- Original XML path extraction from CSV metadata
- Validation that original XML still exists

### Enhancement Needs
- Connect rerun signal to main window processing
- Extract and validate original XML path
- Handle case where original XML moved/deleted
- Show metadata (date, playlist name) from CSV

## Workflow 5: Update Workflow

**Definition**: App checks for updates → Prompt → User updates → App relaunches

### Implementation Status

| Component | Status | File/Notes |
|-----------|--------|------------|
| Update Checker | ❌ Needs creation | `SRC/cuepoint/services/update_checker.py` (Step 5) |
| Update Dialog | ❌ Needs creation | `SRC/cuepoint/ui/dialogs/update_dialog.py` (Step 5) |
| Update Framework | ❌ Needs setup | Sparkle (macOS) / WinSparkle (Windows) (Step 5) |
| App Relaunch | ❌ Needs setup | Handled by update framework (Step 5) |

### Implementation Plan
- **Step 5**: Full update system implementation
- Uses Sparkle (macOS) or WinSparkle (Windows)
- Requires update feed (appcast.xml)
- Requires signed update packages

### Dependencies
- Step 5: Auto-Update System
- Code signing (Steps 3-4)
- Update feed hosting

## Workflow Implementation Summary

### Fully Implemented ✅
- **Workflow 3**: Review/Refine (filtering, candidates, export)
- **Workflow 4**: Past Searches (CSV loading, filtering, export)

### Partially Implemented ⚠️
- **Workflow 1**: First Run (missing onboarding, needs progress enhancement)
- **Workflow 2**: Repeat Run (recent files exist, state persistence incomplete)

### Not Yet Implemented ❌
- **Workflow 5**: Update (deferred to Step 5)

## Required Enhancements

### For Workflow 1 (First Run)
1. Create onboarding dialog (Step 9.4)
2. Add first-run detection
3. Integrate ProgressTracker for progress indication
4. Enhance error messages for first-time users

### For Workflow 2 (Repeat Run)
1. Implement window geometry persistence
2. Save/restore last playlist selection
3. Save/restore last mode (single/batch)
4. Auto-load last XML on startup
5. Add quick start functionality

### For Workflow 3 (Review/Refine)
1. Add filter presets
2. Add "Clear All Filters" button
3. Performance optimization
4. Filter status indicator

### For Workflow 4 (Past Searches)
1. Integrate re-run processing with main window
2. Extract original XML path from CSV
3. Validate original XML exists
4. Show CSV metadata

### For Workflow 5 (Update)
1. Deferred to Step 5

## Code Files Status

### Existing and Working ✅
- `SRC/cuepoint/ui/main_window.py` - Main window with recent files
- `SRC/cuepoint/ui/widgets/file_selector.py` - XML file selection
- `SRC/cuepoint/ui/widgets/playlist_selector.py` - Playlist selection
- `SRC/cuepoint/ui/widgets/results_view.py` - Results and filtering
- `SRC/cuepoint/ui/widgets/history_view.py` - Past searches
- `SRC/cuepoint/ui/widgets/candidate_dialog.py` - Candidate review
- `SRC/cuepoint/ui/dialogs/export_dialog.py` - Export functionality
- `SRC/cuepoint/ui/controllers/main_controller.py` - Processing workflow

### Needs Creation ❌
- `SRC/cuepoint/ui/dialogs/onboarding_dialog.py` (Step 9.4)
- `SRC/cuepoint/services/update_checker.py` (Step 5)
- `SRC/cuepoint/ui/dialogs/update_dialog.py` (Step 5)

### Needs Enhancement ⚠️
- `SRC/cuepoint/ui/main_window.py` - Add state persistence
- `SRC/cuepoint/ui/main_window.py` - Add first-run detection
- `SRC/cuepoint/ui/widgets/results_view.py` - Add filter presets
- `SRC/cuepoint/ui/widgets/history_view.py` - Integrate re-run

## Testing Requirements

### Workflow 1: First Run
- [ ] Test first launch shows onboarding
- [ ] Test onboarding can be skipped
- [ ] Test onboarding completion
- [ ] Test XML selection and validation
- [ ] Test complete first-run flow

### Workflow 2: Repeat Run
- [ ] Test recent files menu
- [ ] Test window state persistence
- [ ] Test last XML auto-load
- [ ] Test last playlist restoration
- [ ] Test quick start functionality

### Workflow 3: Review/Refine
- [ ] Test all filter types
- [ ] Test filter combinations
- [ ] Test candidate review
- [ ] Test filtered export
- [ ] Test filter performance

### Workflow 4: Past Searches
- [ ] Test CSV loading
- [ ] Test filtering past results
- [ ] Test export from history
- [ ] Test re-run processing
- [ ] Test recent CSV files list

### Workflow 5: Update
- [ ] Deferred to Step 5

## Success Criteria

### Workflow Completion Rates
- **First Run**: > 80% complete without help
- **Repeat Run**: < 2 minutes to export
- **Review/Refine**: > 70% use filters
- **Past Searches**: > 50% use feature
- **Update**: > 80% install when prompted (Step 5)

### Code Quality
- ✅ All workflows have error handling
- ⚠️ All workflows have progress indication (needs enhancement)
- ✅ All workflows preserve user data (needs state persistence)
- ✅ All workflows are testable

## Next Steps

1. **Step 1.8**: Define UX requirements (workflows inform requirements)
2. **Step 9.4**: Implement onboarding dialog (Workflow 1)
3. **Step 1.9**: Implement state persistence (Workflow 2)
4. **Step 5**: Implement update system (Workflow 5)

## References

- Detailed workflow guide: `1.3_Primary_Workflows.md`
- Product statement: `01_Product_Requirements_and_Definition.md`
- Personas: `1.2_Target_Users_Personas.md`
- Related: Step 1.8 (UX Requirements), Step 9.4 (Onboarding), Step 5 (Updates)
